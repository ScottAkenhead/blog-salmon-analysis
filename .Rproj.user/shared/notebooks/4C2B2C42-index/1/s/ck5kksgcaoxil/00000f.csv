"0","#| label: fig-scaled"
"0","#| fig-cap: ""Salmon counts scaled (from 0 to 1) by the maximum count each year."" "
"0",""
"0","xa <- by(dat$count,dat$year, max) # get maximums by year"
"0","xb <- by(dat$count,dat$year, length) # number of observations by year"
"0","# one value per year, copy for each obs in a year."
"0","xc <- NULL  # temporary"
"0","for(j in 1:4) xc <- c(xc,rep( xa[[j]], xb[[j]]) )    "
"0","dat$max <- xc "
"0","dat$scaled <- dat$count / dat$max"
"0","xa <- dat[order(dat$day), c(""day"",""scaled"")] # extract and sort"
"0","lo <- loess(scaled ~ day, data=xa) # fit smoother to sorted data"
"0","#  range for resulting smooth line is range of observed days"
"0","days = 5:23"
"0","loPred <- predict(lo, data.frame(day = days) ) # all days in range"
"0","loPred <-data.frame(pred=loPred,day=days)      # not just observed day"
"0",""
"0","SetPar()"
"0","plot(scaled~day,data=xa, xlim=c(0,36),"
"0","     xlab='Day from 31 October', ylab='Scaled Count')"
