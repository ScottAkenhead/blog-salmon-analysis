"0","#| label: fig-years"
"0","#| fig-cap: ""Four Gaussian curves with the same spread describe the observed salmon abundance. 5 or 6 observations in each year estimate just 2 parameters: abundance and timing."""
"0",""
"0","# GssqAllPred <- function(par, dat){"
"0","#     # same as GssqAll but returns the predictions. AND smooth curves."
"0","#     eta <- par[1:4];   mu <- par[5:8]; sigma <- par[9];"
"0","#     years <-  unique(dat[,1]) # 1996 to 1999"
"0","#     nyears <- length(years)"
"0","#     x <- 1:30 # days for smooth"
"0","#     ybar <- numeric(dim(dat)[1] ) # predicted for each day"
"0","#     smooth <- NULL # predicted as smooth curve"
"0","#     m = 0 # row of output, total 21"
"0","#     for (j in 1:nyears) {  # 1 to 4, 1996 to 1999"
"0","#         k <- which(dat[,1] == years[j]) # find rows in a for each year"
"0","#         for (i in k){ # each row in that year"
"0","#             m <- m+1 # row of output"
"0","#             ybar[m]  <- eta[j] * dnorm(dat[m,2],mu[j],sigma)"
"0","#         }"
"0","#         smooth <- c(smooth, eta[j] * dnorm(x,mu[j],sigma)) "
"0","#     }"
"0","#     a <- list(ybar=ybar, smooth=smooth)"
"0","#     return(a)"
"0","# }"
"0",""
"0","x <- c(1:30) # days of September"
"0","# yhat is predicted counts for the days observed"
"0","ymax= 1.1e-3 * max(yhat)  # plot as thousands"
"0","SetPar()"
"0","plot(1e-3*yhat ~ dat[,2], xlim=c(1,30), ylim=c(0, ymax), yaxs=""i"","
"0","     xlab='Day', ylab=""Salmon Counts ('000)"" )"
